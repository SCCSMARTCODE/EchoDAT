<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echodat - {{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/flash-message-style-sheet.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    {% block head%} {% endblock head%}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    
</head>
<body>
    <div class="flash-message-cotainer">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="flash-message {{ category }}">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
    <!-- Header Section -->
    <header id="header">
        <div class="container">
           <!-- Logo Section -->
            <div class="logo">
                <a href="{{ url_for('unauth.homepage') }}">
                    <img src="{{ url_for('static', filename='/system_files/img/logo12.png') }}" alt="Echodat Logo" onerror="this.style.display='none'; 
                    this.nextElementSibling.style.display='block';">
                    <span class="logo-text">Echodat</span>
                </a>
            </div>

            <!-- Search Icon for Mobile -->
            <div class="mobile-search-icon">
                <i class="fas fa-search"></i>
            </div>

            <!-- Toggle Menu Icon for Mobile -->
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            
            <!-- Navigation Links -->
            <nav class="nav-links">
                <ul>
                    <li><a href="#">Discover</a></li>
                    <li><a href="{{ url_for('unauth.about') }}">About</a></li>
                    <li><a href="{{ url_for('unauth.contact') }}">Contact</a></li>
                </ul>
            </nav>
            
            <!-- Search Bar -->
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search...">
            </div>
            <!-- User Actions (Login and Sign Up) -->
            <div class="user-actions">
                {% if not current_user.is_authenticated %}
                    <a href="{{ url_for('unauth.login') }}" id="loginLink">Login</a>
                    <a href="{{ url_for('unauth.registration') }}" id="signupLink">Sign Up</a>
                {% else %}
                    <div class="if-auth">
                        <div class="upload-link-cover">
                            <a href="{{ url_for('auth.user_upload') }}" id="uploadLink" class="upload-link">Upload</a>
                        </div>
                        <div id="userProfile" class="dropdown">
                            <div class="hover-drop">
                                <img src="{{ url_for('static', filename='users_profile_avatar/' + avatar_name) }}" alt="User Avatar" id="userAvatar">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M468-240q-96-5-162-74t-66-166q0-100 70-170t170-70q97 0 166 66t74 162l-84-25q-13-54-56-88.5T480-640q-66 0-113 47t-47 113q0 57 34.5 100t88.5 56l25 84ZM821-60 650-231 600-80 480-480l400 120-151 50 171 171-79 79Z"/></svg>
                            </div>
                                <div class="dropdown-content">
                                <a href="{{ url_for('auth.user_profile') }}">Profile</a>
                                <a href="{{ url_for('auth.user_dashboard') }}">Dashboard</a>
                                <a href="{{ url_for('auth.get_help') }}">Help</a>
                                <hr>
                                <a href="{{ url_for('unauth.login', SA='10w1e03r') }}">Switch Account</a>
                                <a href="{{ url_for('auth.edit_profile') }}">Account Settings</a>
                                <a href="{{ url_for('auth.logout') }}" id="logoutLink">Logout</a>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </header>
    {% block body%} {% endblock body%}

    <footer id="footer">
        <div class="footer-container">
            <!-- Echodat Logo -->
            <div class="footer-logo">
                <img src="{{ url_for('static', filename='/system_files/img/logo11.png') }}" alt="Echodat Logo">
            </div>
    
            <!-- Social Media Icons -->
            <div class="footer-social-icons">
                <a href="https://twitter.com"><i class="fab fa-twitter"></i></a>
                <a href="https://youtube.com"><i class="fab fa-youtube"></i></a>
                <a href="https://facebook.com"><i class="fab fa-facebook"></i></a>
                <a href="https://tiktok.com"><i class="fab fa-tiktok"></i></a>
            </div>
    
            <!-- Footer Links -->
            <div class="footer-links">
                <a href="#">ABOUT</a>
                <a href="#">HELP</a>
                <a href="#">BUSINESS INQUIRIES</a>
                <a href="#">GET STARTED</a>
            </div>
    
            <!-- Footer Text -->
            <div class="footer-text">
                <p>
                    Echodat is an on-demand music streaming and audio discovery platform that allows artists and creators to upload limitless music and podcasts for listeners through its mobile apps and website.
                </p>
            </div>
    
            <!-- Privacy and Terms Links -->
            <div class="footer-privacy-terms">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Your Privacy Rights</a>
            </div>
    
            <!-- Copyright Text -->
            <div class="footer-copyright">
                <p>Â© 2024 Echodat - All Rights Reserved</p>
            </div>
        </div>
    </footer>

    <script>

        window.addEventListener('scroll', function() {
            var header = document.getElementById('header');
            if (window.pageYOffset > 0) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        window.addEventListener('scroll', function() {
            var logo = document.querySelector('.logo img');
            if (window.pageYOffset > 0) {
                logo.src = "{{ url_for('static', filename='/system_files/img/logo11.png') }}"; // Change to the white logo
            } else {
                logo.src = "{{ url_for('static', filename='/system_files/img/logo12.png') }}"; // Change back to the green logo
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            // const loginModal = document.getElementById('loginModal');
            // const signupModal = document.getElementById('signupModal');
            // const loginLink = document.getElementById('loginLink');
            // const signupLink = document.getElementById('signupLink');
            const userProfile = document.getElementById('userProfile');
            const userName = document.getElementById('userName');
            const logoutLink = document.getElementById('logoutLink');

            function showModal(modal) {
                return (event) => {
                    event.preventDefault();
                    modal.style.display = 'block';
                };
            }

            loginLink.addEventListener('click', showModal(loginModal));
            signupLink.addEventListener('click', showModal(signupModal));

            window.addEventListener('click', (event) => {
                if (event.target === loginModal) {
                    loginModal.style.display = 'none';
                } else if (event.target === signupModal) {
                    signupModal.style.display = 'none';
                }
            });

            logoutLink.addEventListener('click', () => {
                localStorage.removeItem('token');
                userProfile.style.display = 'none';
                window.location.href = 'index.html';
            });

            const tokenFromStorage = localStorage.getItem('token');
            if (tokenFromStorage) {
                const userData = getUserDataFromToken(tokenFromStorage);
                if (userData) {
                    userName.textContent = userData.username;
                    userProfile.style.display = 'block';
                }
            } else {
                userProfile.style.display = 'none';
            }

            function getUserDataFromToken(token) {
                // Implement your logic to decode token and return user data
                return { username: 'SmartDammy' }; // Example, replace with actual logic
            }
        });
    </script>
        {% block script %} {% endblock script %}
</body>
</html>